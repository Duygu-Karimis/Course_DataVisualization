---
title: "Visualizing Distributions"
author: "Mustafa Cavus"
date: "2025-10-13"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE, include=FALSE}
# Installing and loading the required packages
install.packages("DALEX") # to access the Titanic dataset
install.packages("dplyr") # to use the pipe operator
install.packages("ggplot2")
library(DALEX)
library(dplyr)
library(ggplot2)
```

# 1. Load the dataset

Loading the Titanic dataset


```{r}
data(titanic)
```

Now we can view the dataset using the titanic command.

# 2. Drawing a histogram

After using the following codes, you will have drawn the histogram, but you will 
also encounter an error. This is due to the lack of a sufficient number of 
observations to calculate the histogram bins for high age values.

```{r warning=FALSE}
ggplot(titanic, aes(x = age)) + 
  geom_histogram()
```

We can draw histograms for different bin values by changing the `binwidth` 
argument in the `geom_histogram()` layer.

```{r warning=FALSE}
ggplot(titanic, aes(x = age)) + 
  geom_histogram(binwidth = 5)
```

In the histograms you have drawn, you will see that the bins are not 
separated from each other. This is because both the bins and the bin borders 
are drawn in black. To change this, you need to modify the `color` and `fill` 
arguments in the `geom_histogram()` layer.

```{r warning=FALSE}
ggplot(titanic, aes(x = age)) + 
  geom_histogram(binwidth = 5, 
                 color = "black", 
                 fill = "yellow")
```

Let's adjust the axis names and the plot title:

```{r warning=FALSE}
ggplot(titanic, aes(x = age)) + 
  geom_histogram(binwidth = 5, color = "white", fill = "grey30") + 
  labs(x = "Age", 
       y = "Frequency",
       title = "Age Distribution of Titanic Passengers")

```

Although the largest value label on the x-axis is 60, we see that there are 
observations greater than this value. A similar situation is observed on the 
y-axis as well. Therefore, the axis limits need adjustment:

```{r warning=FALSE}
ggplot(titanic, aes(x = age)) + 
  geom_histogram(color = "white", fill = "black") +
  labs(x = "Age", 
       y = "Frequency",
       title = "Age Distribution of Titanic Passengers",
       subtitle = "Histogram") + 
  lims(x = c(0, 80), y = c(0, 500))
```

# 3. Drawing multiple histograms with `{gridExtra}`

First install the package:

```{r echo=FALSE, message=FALSE, warning=FALSE}
install.packages("gridExtra")
library(gridExtra)
```

Then, draw four histograms with different `binwidth`s.

```{r}
g1 <- ggplot(titanic, aes(x = age)) + 
  geom_histogram(binwidth = 1, color = "white", fill = "grey30") + 
  labs(x = "Age", 
       y = "Frequency",
       title = "binwidth = 1")

g2 <- ggplot(titanic, aes(x = age)) + 
  geom_histogram(binwidth = 3, color = "white", fill = "grey30") + 
  labs(x = "Age", 
       y = "Frequency",
       title = "binwidth = 3")

g3 <- ggplot(titanic, aes(x = age)) + 
  geom_histogram(binwidth = 5, color = "white", fill = "grey30") + 
  labs(x = "Age", 
       y = "Frequency",
       title = "binwidth = 5")

g4 <- ggplot(titanic, aes(x = age)) + 
  geom_histogram(binwidth = 10, color = "white", fill = "grey30") + 
  labs(x = "Age", 
       y = "Frequency",
       title = "binwidth = 10")
```

The next step is to arrange them:

```{r warning=FALSE}
grid.arrange(
  g1,
  g2,
  g3, 
  g4
)
```

# 4. Drawing a stacked histogram

By using the `fill` argument, the histogram can be stacked:

```{r warning=FALSE}
ggplot(titanic, aes(x = age, fill = gender)) + 
  geom_histogram(color = "black") +
  labs(x = "Age", 
       y = "Frequency",
       title = "Age Distribution of Titanic Passengers by Gender",
       subtitle = "Stacked Histogram",
       fill = "Gender") + 
  scale_fill_discrete(labels = c("Female", "Male")) +
  lims(x = c(0, 80), y = c(0, 300)) + 
  theme_bw()
```

# 5. Drawing a kernel density plot

```{r warning=FALSE}
ggplot(titanic, aes(x = age, fill = gender)) + 
  geom_density() +
  labs(x        = "Age", 
       y        = "Density",
       title    = "Age Distribution of Titanic Passengers by Gender",
       subtitle = "Kernel Density Estimation",
       fill     = "Gender") + 
  scale_fill_discrete(labels = c("Female", "Male")) +
  lims(x = c(0, 80), y = c(0, 0.04))
```

In the graph obtained using the code above, the age distribution curves by 
`gender` overlap, making it difficult to see the overall picture of the 
background level. To resolve this, the colors need to be made transparent. 

This requires changing the value of the `alpha` argument in the `geom_density()` 
layer. The `alpha` argument takes values between 0 and 1: 0 represents the most 
transparent value and 1 represents the most opaque value.

```{r warning=FALSE}
ggplot(titanic, aes(x = age, fill = gender)) + 
  geom_density(alpha = 0.5) +
  labs(x = "Age", 
       y = "Density",
       title = "Age Distribution of Titanic Passengers by Gender",
       subtitle = "Kernel Density Estimation",
       fill = "Gender") + 
  scale_fill_discrete(labels = c("Female", "Male")) +
  lims(x = c(0, 80), y = c(0, 0.04)) + 
  theme_bw()
```

# 6. Drawing a stacked kernel density plot

To create a stacked kernel density plot, the position argument in the 
`geom_density` layer needs to be set to `fill`. With this selection, the 
stacking operation is performed according to the `fill` argument in the 
ggplot layer.

```{r warning=FALSE}
ggplot(titanic, aes(x = age, fill = gender)) + 
  geom_density(position = "fill") +
  labs(x = "Age", 
       y = "Density",
       title = "Age Distribution of Titanic Passengers by Gender",
       subtitle = "Stacked Kernel Density Estimation",
       fill = "Gender") + 
  scale_fill_discrete(labels = c("Female", "Male"))  
```







